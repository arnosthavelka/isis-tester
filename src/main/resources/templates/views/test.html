<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="layout">
<head>
	<title>Test evaluation</title>
	<script type="text/javascript">
		/*<![CDATA[*/
		function evaluateTest(sectionIdent) {
	        var x = document.getElementsByName('rr-s' + sectionIdent);
	        for (var i = 0; i < x.length; i++) {
	        	x[i].style.visibility = "visible";
	        }
		}
		function showResults(sectionIdent) {
	        var x = document.getElementsByTagName("INPUT");
	        for (var i = 0; i < x.length; i++) {
	        	var name = x[i].name;
	        	if (name.startsWith('response-s' + sectionIdent + 'q')) {
		        	var clazz = x[i].className;
		        	if (clazz.includes("abc")) {
		        		// x[i].innerHTML = '<span class="label label-success" >'+ x[i].value + '</span>';
		        		var el = x[i].nextElementSibling;
		        		el.innerHTML = '<span class="label label-success" >'+ el.innerText + '</span>';
		        	}
	        	}; 
	        }
		}
		/*]]>*/
	</script>
</head>
<body>
	<h2 layout:fragment="header" id="_top">Test : <span th:text="${dto.id}">XYZ</span></h2>
	<div layout:fragment="content" class="container">
		<span th:each="section : ${dto.sections}">
			<a th:attr="href='#section' + ${section.ident} + ''"><span th:text="${section.title}">No title</span></a> |
		</span>
		<div th:each="section : ${dto.sections}" class="panel panel-default">
			<div class="panel-heading">
				<h3 th:attr="id='section' + ${section.ident} + ''"><span th:text="${section.title}">No title</span> [Ident=<span th:text="${section.ident}">No ident</span>]</h3>
				<button type="button" class="btn btn-primary" th:onclick="'javascript:showResults(' + ${section.ident} + ')'">Evaluate (new)</button>
				<a href="#_top"><span class="glyphicon glyphicon-upload"></span></a>
				Min. score:<span th:text="${section.minScore}">No min. score</span>, 
				Time limit:<span th:text="${section.timeLimit}">No time limit</span>,
				Questions: <span th:text="${#lists.size(section.questions)}">No question</span>
			</div>

			<div class="panel-body">			
				<div th:each="question : ${section.questions}">
					<h3 class="alert alert-warning"><span th:text="${question.title}">No title</span></h3>
					<em th:text="${question.comment}">No comment</em>

					<!-- add input box for the correct answer -->
					<div th:switch="${question.type}">
						<span th:case="'FIB'"><input type="text" th:attr="name='response-s' + ${section.ident} + 'q' + ${question.ident} + ''" /></span>
					</div>
	
					<div th:each="response : ${question.responses}">
						<p th:switch="${question.type}">
							<span th:case="'1ofN'"><input type="radio" th:attr="name='response-s' + ${section.ident} + 'q' + ${question.ident} + ''" th:value="${response.ident}" class="abc" /> <span th:text="${response.title}">No title</span></span>
							<span th:case="'MofN'"><input type="checkbox" th:attr="name='response-s' + ${section.ident} + 'q' + ${question.ident} + ''" th:value="${response.ident}" /> <span th:text="${response.title}">No title</span></span>
							<span th:case="'FIB'" th:attr="name='rr-s' + ${section.ident} + ''" style="visibility:hidden"><input type="radio" th:attr="name='response-s' + ${section.ident} + 'q' + ${question.ident} + ''" th:value="${response.ident}" /> <span th:text="${response.title}">No title</span></span>
							<span th:case="*">Unknown question type!</span>
							<span th:if="${response.right == 'yes'}" th:attr="name='rr-s' + ${section.ident} + ''" class="label label-success" style="visibility:hidden">OK</span>
						</p>
					</div>
				</div>
			</div>
			<div class="panel-footer">
				<button type="button" class="btn btn-primary" th:onclick="'javascript:evaluateTest(' + ${section.ident} + ')'">Evaluate</button>
			</div>
		</div>
	</div>
</body>
</html>
